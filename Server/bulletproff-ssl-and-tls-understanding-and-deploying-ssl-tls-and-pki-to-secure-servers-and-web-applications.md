# HTTPS 权威指南 在服务器和Web应用上部署SSL/TLS和PKI

## 11.2 密钥和证书管理

大多数用户借助OpenSSL是因为希望配置并运行能够支持SSL的Web服务器. 整个过程包括3 个步骤:
1. 生成强加密的私钥;
2. 创建证书签名申请(certificate signing request，CSR)并且发 送给CA;
3. 在你的Web服务器上安装CA提供的证书

### 11.2.1 生成密钥

在使用公钥加密之前的第一步是生成一个私钥. 在开始之前，你必须进行几个选择. 

#### 密钥算法
OpenSSL支持RSA、DSA和ECDSA密钥，但是在实际使用场景中不是所有密钥类型都适用的. 例如对于Web服务器的密钥，所有人都使用RSA，因为DSA一般因为效率问题会 14 限制在1024位(Internet Explorer不支持更长的DSA密钥)，而ECDSA还没有被大部分的CA支持. 对于SSH来说，一般都是使用DSA和RSA，而不是所有的客户端都支持ECDSA算法. 

#### 密钥长度
默认的密钥长度一般都不够安全，所以我们需要指定要配置的密钥长度。例如RSA密钥 默认的长度是512位，非常不安全。如果今天你的服务器上还是用512位的密钥，入侵者可以先获取你的证书，使用暴力方式来算出对应的私钥，之后就可以冒充你的站点了。 现在，一般认为2048位的RSA密钥是安全的，所以你应该采用这个长度的密钥。DSA密 钥也应该不少于2048位，ECDSA密钥则应该是256位以上。

#### 密码
强烈建议使用密码去保存密钥，虽然这是只一个可选项。受密码保护的密钥可以被安全 地存储、传输以及备份。但与此同时，这样的密钥也会带来不便，因为我们如果没有密 码的话，就无法使用密钥了。例如每次你想要重启Web服务器的时候就会被要求输入密码。

#### 使用`genrsa`命令来生成RSA密钥

```bash
$ openssl genrsa -aes128 -out fd.key 2048
```

这里，我指定私钥会使用AES-128算法来加密保存。当然也可以使用AES-192或者AES-256 (分别使用开关-aes192和-aes256)，但是最好不要使用其他算法(DES、3DES和SEED)。私钥以所谓的PEM格式存储. 你可以使用下面的rsa命令解析出私钥的结构: 
    $ openssl rsa -text -in fd.key
如果你需要单独查看密钥的公开部分，可以使用下面的rsa命令: 
    $ openssl rsa -in fd.key -pubout -out fd-public.key

